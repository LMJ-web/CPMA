<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>星辰电脑维修</title>
    <link rel="stylesheet" type="text/css" href="~/PageUI/MyInfoIndexUi/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="~/layui/css/layui.css" />
    <link rel="stylesheet" type="text/css" href="~/PageUI/MyInfoIndexUi/css/style.css" />

    <script src="~/PageUI/MyInfoIndexUi/js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="~/PageUI/MyInfoIndexUi/js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="~/layui/layui.js" type="text/javascript" charset="utf-8"></script>

    <!--城市联动-->
    <link rel="stylesheet" type="text/css" href="~/PageUI/UserInfoIndex/city/city.css">
    <script src="~/PageUI/UserInfoIndex/city/Popt.js"></script>
    <script src="~/PageUI/UserInfoIndex/city/cityJson.js"></script>
    <script src="~/PageUI/UserInfoIndex/city/citySet.js"></script>
    <style>
        .nav li a {
            /*设置导航字体大小*/
            font-size: 16px;
        }
    </style>
</head>
<body>
    @*页面标志*@
    <input type="text" id="YM" value="SJRZ" hidden />
    <div style="height:500px;">
        <!--介绍-->
        <div style="height:10px;text-align:center;font-size:20px;margin-top:100px;">
            商家入驻可以发布商家的预约信息，同时可以出售发布自己的各种电子产品！
        </div>
        <!--Modal-->
        <div style="text-align:center;margin-top:100px;">
            <button class="layui-btn layui-btn-normal layui-btn-radius" onclick="CheckRegShop()">
                开始入驻
            </button>
            <button class="layui-btn layui-btn-normal layui-btn-radius" data-toggle="modal" data-target="#ShopInfoTX" id="SureAddShop" style="display:none;">
                开始入驻
            </button>
        </div>
        <!-- 模态框（Modal） -->
        <div class="modal fade" id="ShopInfoTX" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="width:auto;">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"
                                aria-hidden="true">
                            ×
                        </button>
                        <h2 class="modal-title" id="myModalLabel" style="text-align:center">
                            商家注册
                        </h2>
                    </div>
                    <div class="modal-body">
                        <form class="layui-form layui-form-pane" action="" style="padding-left:1px;" method="post">
                            <div class="layui-form-item">
                                <label class="layui-form-label">商店名</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="ShopName" id="ShopName" lay-verify="required|shopName" placeholder="请输入商店名" autocomplete="off" class="layui-input">
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <label class="layui-form-label">联系人</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="ShopContact" id="ShopContact" lay-verify="required" placeholder="请输入联系人" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">手机号码</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="ShopPhone" id="ShopPhone" lay-verify="required|phone" placeholder="请输入手机号码" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <label class="layui-form-label">营业时间</label>
                                    <div class="layui-input-inline" style="width: 100px;">
                                        <input type="text" name="StartTime" id="StartTime" lay-verify="required" autocomplete="off" class="layui-input">
                                    </div>
                                    <div class="layui-form-mid">-</div>
                                    <div class="layui-input-inline" style="width: 100px;">
                                        <input type="text" name="EndTime" id="EndTime" lay-verify="required" autocomplete="off" class="layui-input">
                                    </div>
                                </div>

                            </div>


                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <label class="layui-form-label">价格</label>
                                    <div class="layui-input-inline" style="width: 100px;">
                                        <input type="text" name="MinPrice" id="MinPrice" placeholder="￥" lay-verify="required|number" autocomplete="off" class="layui-input">
                                    </div>
                                    <div class="layui-form-mid">-</div>
                                    <div class="layui-input-inline" style="width: 100px;">
                                        <input type="text" name="MaxPrice" id="MaxPrice" placeholder="￥" lay-verify="required|number" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">商店地址</label>
                                <!--插入插件-->
                                <div class="layui-input-block">
                                    <input type="text" id="ShopAddress" name="ShopAddress" value="请选择地区..." lay-verify="required" autocomplete="off" class="layui-input" />
                                    <script type="text/javascript">
                                    $("#ShopAddress").click(function (e) {
                                        SelCity(this, e);
                                    });
                                    </script>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">详细地址</label>
                                <div class="layui-input-block">
                                    <input type="text" name="ShopDAddress" id="ShopDAddress" autocomplete="off" placeholder="请输入商店地址" lay-verify="required" class="layui-input">
                                </div>
                            </div>

                            <div class="layui-form-item layui-form-text">
                                <label class="layui-form-label">商店介绍</label>
                                <div class="layui-input-block">
                                    <textarea placeholder="请输入内容" class="layui-textarea" id="ShopIntroduce"></textarea>
                                </div>
                            </div>
                            @*<div class="layui-form-item" hidden>
                                <button class="layui-btn" lay-submit="" lay-filter="submit" id="regShopBtn">提交</button>
                            </div>*@
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="Model_Submit_Btn">
                            确认
                        </button>
                        <button type="button" class="btn btn-default"
                                data-dismiss="modal" id="ClosemShopRegModel">
                            关闭
                        </button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
        <div style="margin-bottom:31px;"></div>
    </div>

</body>
</html>

<script>
    /*--------------操作---------------*/
    //获取session中的user
    var user = JSON.parse(sessionStorage.user);

    //检查商家是否已注册过
    function CheckRegShop() {
        $.ajax({
            url: "/Shop/CheckRegShop",
            data: {
                UserName: user.UserName,
            },
            dataType: "json",
            type: "post",
            async: false,
            success: function (data) {
                if (data == true) {
                    LayerAlert("该账号已注册过商店，请勿重复入驻！");
                    return false;
                } else {
                    $("#SureAddShop").click();
                }
            }

        });

    }

    //提示框
    function LayerAlert(content) {
        layer.alert(content, {
            icon: 5,
            title: "提示"
        });
        return false;
    }

    //数据校验
    layui.use(['form', 'layedit', 'laydate'], function () {
        var form = layui.form
        , layer = layui.layer
        , layedit = layui.layedit
        , laydate = layui.laydate;

        //时间选择器
        laydate.render({
            elem: '#StartTime'
            , type: 'time'
            , value: '08:00:00'
        });
        laydate.render({
            elem: '#EndTime'
            , type: 'time'
              , value: '20:00:00'
        });

        //创建一个编辑器
        var editIndex = layedit.build('LAY_demo_editor');

        //自定义验证规则
        form.verify({
            ShopName: function (value) {
                if (value.length < 1) {
                    return '商店名至少得1个字符啊';
                }
            }
          , pass: [/(.+){6,12}$/, '密码必须6到12位']
          , content: function (value) {
              layedit.sync(editIndex);
          }

        });

    });

    //监听提交
    $("#Model_Submit_Btn").click(function (){
        var endState = false;
        //开始注册商家
        $.ajax({
            url: "/Shop/RegisterShop",
            data: {
                UserName: user.UserName,
                ShopName: $("#ShopName").val(),
                ShopContact: $("#ShopContact").val(),
                ShopPhone: $("#ShopPhone").val(),
                StartTime: $("#StartTime").val(),
                EndTime: $("#EndTime").val(),
                MinPrice: parseInt($("#MinPrice").val()),
                MaxPrice: parseInt($("#MaxPrice").val()),
                ShopAddress: $("#ShopAddress").val(),
                ShopDAddress: $("#ShopDAddress").val(),
                ShopIntroduce: $("#ShopIntroduce").val()
            },
            dataType: "json",
            type: "post",
            async: false,
            success: function (data) {
                if (data == true) {
                    layer.alert("商店注册成功！！", {
                        icon: 1,
                        title: "提示"
                    });
                    $("#ClosemShopRegModel").click();
                    return true;
                } else if (data == "ShopName_Already") {
                    layer.alert("商店名已存在！！", {
                        icon: 5,
                        title: "提示"
                    });
                    return false;
                } else {
                    layer.alert("商店注册失败！！", {
                        icon: 5,
                        title: "提示"
                    });
                    $("#ClosemShopRegModel").click();
                    return false;
                }
            }
        });
    });
</script>